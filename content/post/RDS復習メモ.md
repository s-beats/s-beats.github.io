---
title: "RDS復習メモ"
date: 2021-12-18T12:00:24+09:00
draft: false
comments: false
adsense: false
---

業務でRDSを使うことになったので再復習がてら雑なメモを残す。

## 概要

- マネージドRDBサービスである。
- バックアップ、ハードのメンテナンス、障害時の復旧など面倒見てくれる。
- エンジンは複数種類用意されている。

## ストレージ 

- 保存用ストレージにはEBSを使う。
	- 汎用SSD、プロビジョンドIOPS SSD、マグネティックの三種から選択する。
- 高いIOPSが求められる際はプロビジョンドIOPS SSDを使う。
- ストレージ拡張はダウンタイムなしで可能だが、拡張中は若干パフォーマンスが落ちる。

## マルチAZ

- 二つのAZにDBインスタンスを配置可能である。
- 障害発生時やメンテナンスのダウンタイムを短縮して高い可用性を保てる。
- 片方のAZにはマスターDBインスタンス、もう片方にはスタンバイDBインスタンスが配置される。
- マスターとスタンバイの同期レプリケーション(リアルタイムでの複製作成)により冗長化される。
- マスターへの更新時に、同期レプリケーションが実行されて更新完了となる。
- 若干の遅延はあるが、数ms程度である。
- フェイルオーバーが発生した際は、RDSのFQDNのDNSレコードがスタンバイ側IPに差し向けられる。
	- アプリケーション側でIPのキャッシュを持っている場合は、一時的に接続できなくなる。

## リードレプリカ

- 参照専用のDBインスタンスである。
- マスターのメンテナンス時も、参照は止めないという運用が可能となる。
- マスターへの負荷を抑えられる。
- マスターとのデータ同期は非同期レプリケーション方式で実行される。
- 書き込み時にパフォーマンスへの影響はないが、反映まで若干のタイムラグがある。

## バックアップ

- 自動バックアップ可能である。
	- 1日1回自動でDBスナップショットを取得する。
	- 保持期間は最大35日である。
	- スナップショットを選択して新しいDB作成可能である。
	- 稼働中のインスタンスにバックアップデータを置き換えることはできない。(新しく作るしかない)
- 手動スナップショットも可能である。
	- 1リージョンあたり100個までという制限がある。
	- シングルAZの場合、短時間のI/O中断時間がある。(自動バックアップも)
	- マルチAZの場合は、スタンバイからスナップショットを取るのでマスターへの影響はない。(I/Oのダウンタイムはない)

## リストア

- スナップショットを選んで新しいインスタンスを作成する。

## ポイントタイムリカバリー

- 直近5分前から最大35日前までの任意のタイミングの状態のDBインスタンスを作成可能である。
- 最大日数は自動バックアップの期間に準ずる。
	- 自動バックアップ有効の場合のみポイントタイムリカバリ可能である。

## ネットワーク

- VPC内に配置可能で、インターネット非公開にできる。
- ほかのサービスからの通信はエンジンが提供するSSLを使った暗号化で守られる。

## 暗号化

- 暗号化有効にすることで、ストレージ 、スナップショット、ログなどを暗号化して保存できる。
- 途中から有効にすることはできない。
- スナップショット暗号化コピーを作って、そのコピーからDBインスタンスを作成することで既存のデータを暗号化できる。

## Aurora

- AWS独自のエンジンで、ハイパフォーマンスである。
- MySQL互換のエディション、PostgreSQL互換のエディションがある。

### 構成

- インスタンスを作成すると、Auroraクラスタが作成される。
- クラスタは、DBインスタンス、クラスタボリューム(ストレージ)で構成される。
- ボリュームはSSDベースである。
- クラスタボリュームは、単一リージョン内の3つのAZにあるそれぞれ2つのコピーで構成される。
	- 自動で同期される。
	- 自動で64TBまで拡張される。

### レプリカ

- マスタのマルチAZ構成はない。
- クラスタ内のリードレプリカが、プライマリインスタンスに昇格することでフェイルオーバーを実現する。

### エンドポイント

- プライマリインスタンスへのエンドポイントはクラスタエンドポイントとなる。
- リードレプリカへのエンドポイントは読み取りエンドポイントとなる。
	- 複数のレプリカインスタンスがある場合は自動で負荷分散される。
- インスタンスごとのエンドポイントはインスタンスエンドポイントとなる。
- インスタンスエンドポイントをグルーピングして、カスタムエンドポイントを作成することも可能である。

